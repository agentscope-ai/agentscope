
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "tutorial/task_rag.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_tutorial_task_rag.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_tutorial_task_rag.py:


.. _rag:

RAG
==========================

AgentScope æä¾›äº†å†…ç½®çš„ RAGï¼ˆRetrieval-Augmented Generation) å®ç°ã€‚æœ¬èŠ‚å°†è¯¦ç»†ä»‹ç»

- å¦‚ä½•ä½¿ç”¨ AgentScope ä¸­çš„ RAG æ¨¡å—ï¼Œ
- å¦‚ä½•å®ç° **å¤šæ¨¡æ€** RAGï¼Œ
- å¦‚ä½•åœ¨ ``ReActAgent`` ä¸­ä»¥ä¸¤ç§ä¸åŒçš„æ–¹å¼é›†æˆ RAG æ¨¡å—ï¼š
    - æ™ºèƒ½ä½“è‡ªä¸»æ§åˆ¶ï¼ˆAgentic mannerï¼‰
    - é€šç”¨æ–¹å¼ï¼ˆGeneric mannerï¼‰

æˆ‘ä»¬åœ¨ä¸‹åˆ—è¡¨æ ¼ä¸­æ€»ç»“äº†ä¸¤ç§æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ï¼š

.. list-table:: RAG é›†æˆæ–¹å¼æ¯”è¾ƒ
    :header-rows: 1

    * - é›†æˆæ–¹å¼
      - æè¿°
      - ä¼˜ç‚¹
      - ç¼ºç‚¹
    * - æ™ºèƒ½ä½“è‡ªä¸»æ§åˆ¶
      - ä»¥å·¥å…·è°ƒç”¨æ–¹å¼è®©æ™ºèƒ½ä½“è‡ªä¸»å†³å®šä½•æ—¶è¿›è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä»€ä¹ˆå…³é”®å­—
      - - ä¸ ReAct ç®—æ³•å¥‘åˆï¼Œçµæ´»æ€§é«˜
        - æ™ºèƒ½ä½“èƒ½å¤Ÿæ ¹æ®å½“å‰çš„ä¸Šä¸‹æ–‡æ”¹å†™æŸ¥è¯¢å…³é”®è¯
        - é¿å…åœ¨ä¸å¿…è¦æ—¶å‘ç”ŸæŸ¥è¯¢
      - å¯¹ LLM æ¨¡å‹èƒ½åŠ›è¦æ±‚è¾ƒé«˜
    * - é€šç”¨æ–¹å¼
      - æ¯æ¬¡åœ¨ ``reply`` å‡½æ•°å¼€å§‹æ—¶å›ºå®šè¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶å°†æ£€ç´¢ç»“æœæ•´åˆåˆ°æç¤ºï¼ˆpromptï¼‰ä¸­
      - - å®ç°ç®€å•
        - å¯¹ LLM æ¨¡å‹èƒ½åŠ›è¦æ±‚ä½
      - - æ¯æ¬¡éƒ½ä¼šè¿è¡ŒæŸ¥è¯¢ï¼Œå› æ­¤ä¼šå¼•å…¥è¿‡å¤šä¸å¿…è¦çš„æŸ¥è¯¢æ£€ç´¢
        - æŸ¥è¯¢æ•°æ®åº“è¾ƒå¤§æ—¶ï¼Œå›å¤å»¶è¿Ÿè¾ƒé«˜

.. note:: ä½œä¸ºå¼€æºæ¡†æ¶ï¼ŒAgentScope çš„ç›®æ ‡æ˜¯è®©å¼€å‘è¿‡ç¨‹æ›´ç®€å•ä¹Ÿæ›´æœ‰è¶£ã€‚å› æ­¤ï¼ŒAgentScope çš„è®¾è®¡ä¸­å¹¶ä¸å¼ºåˆ¶è¦æ±‚ä½¿ç”¨å†…ç½®çš„ RAG å®ç°ï¼ŒåŒæ—¶æ”¯æŒã€é¼“åŠ±å¼€å‘è€…é›†æˆç°æœ‰çš„ RAG å®ç°æˆ–ç¬¬ä¸‰æ–¹ RAG æ¡†æ¶ã€‚

.. GENERATED FROM PYTHON SOURCE LINES 41-65

.. code-block:: Python

    import asyncio
    import json
    import os

    from matplotlib import pyplot as plt

    import agentscope
    from agentscope.agent import ReActAgent
    from agentscope.embedding import (
        DashScopeTextEmbedding,
        DashScopeMultiModalEmbedding,
    )
    from agentscope.formatter import DashScopeChatFormatter
    from agentscope.message import Msg
    from agentscope.model import DashScopeChatModel
    from agentscope.rag import (
        TextReader,
        SimpleKnowledge,
        QdrantStore,
        Document,
        ImageReader,
    )
    from agentscope.tool import Toolkit








.. GENERATED FROM PYTHON SOURCE LINES 66-78

ä½¿ç”¨ RAG æ¨¡å—
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
AgentScope ä¸­çš„ RAG æ¨¡å—ç”±ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶æ„æˆï¼š

- **Reader**ï¼šè´Ÿè´£ä»æ•°æ®æºè¯»å–æ•°æ®ï¼Œå¹¶è¿›è¡Œåˆ†å—ï¼ˆchunkingï¼‰
- **Knowledge**ï¼šè´Ÿè´£çŸ¥è¯†åº“æŸ¥è¯¢æ£€ç´¢å’Œæ•°æ®å­˜å‚¨é€»è¾‘çš„ç®—æ³•å®ç°
- **Store**ï¼šè´Ÿè´£ä¸å‘é‡æ•°æ®åº“äº¤äº’çš„é€»è¾‘å®ç°

.. note:: æˆ‘ä»¬å°†æŒç»­åœ¨ AgentScope ä¸­é›†æˆæ–°çš„å‘é‡æ•°æ®åº“å’Œæ•°æ®è¯»å–æ¨¡å—ã€‚è¯¦æƒ…è¯·æŸ¥çœ‹æˆ‘ä»¬çš„ `å¼€å‘è·¯çº¿å›¾ <https://github.com/orgs/agentscope-ai/projects/2>`_ï¼ŒåŒæ—¶ä¹Ÿæ¬¢è¿è´¡çŒ®ä»£ç ï¼

å½“å‰ AgentScope ä¸­å†…ç½®æ”¯æŒçš„ reader åŒ…æ‹¬ï¼š


.. GENERATED FROM PYTHON SOURCE LINES 78-83

.. code-block:: Python


    for _ in agentscope.rag.__all__:
        if _.endswith("Reader"):
            print(f"- {_}")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    - TextReader
    - PDFReader
    - ImageReader
    - WordReader
    - ExcelReader
    - PowerPointReader




.. GENERATED FROM PYTHON SOURCE LINES 84-92

è¿™äº› reader çš„ä½œç”¨æ˜¯è¯»å–æ•°æ®ï¼Œå°†æ•°æ®åˆ†å—å¹¶åŒ…è£…æˆ ``agentscope.rag.Document`` å¯¹è±¡ã€‚ ``Document`` å¯¹è±¡åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

- ``metadata``ï¼šæ•°æ®å—çš„å…ƒä¿¡æ¯ï¼ŒåŒ…å«æ•°æ®å†…å®¹ï¼ˆ``content``ï¼‰ã€æ•°æ® IDï¼ˆ``doc_id``ï¼‰ã€å— IDï¼ˆ``chunk_id``ï¼‰å’Œæ€»å—æ•°ï¼ˆ``total_chunks``ï¼‰
- ``embedding``: æ•°æ®å—çš„å‘é‡è¡¨ç¤ºï¼Œé»˜è®¤ä¸º ``None``ï¼Œåœ¨å°†æ•°æ®å—æ·»åŠ åˆ°çŸ¥è¯†åº“æ—¶ä¼šè¢«å¡«å……
- ``score``: æ•°æ®å—çš„ç›¸å…³æ€§åˆ†æ•°ï¼Œé»˜è®¤ä¸º ``None``ï¼Œåœ¨ä»çŸ¥è¯†åº“æ£€ç´¢æ•°æ®å—æ—¶ä¼šè¢«å¡«å……

ä»¥ ``TextReader`` ä¸ºä¾‹ï¼Œé€šè¿‡å¦‚ä¸‹ä»£ç è¯»å–æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œå¹¶å°†æ–‡æœ¬åˆ†å—ä¸º ``Document`` å¯¹è±¡ï¼š


.. GENERATED FROM PYTHON SOURCE LINES 92-127

.. code-block:: Python



    async def example_text_reader(print_docs: bool) -> list[Document]:
        """ä½¿ç”¨ TextReader è¯»å–æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œå¹¶å°†æ–‡æœ¬åˆ†å—ä¸º Document å¯¹è±¡ã€‚"""
        # åˆ›å»º TextReader å¯¹è±¡
        reader = TextReader(chunk_size=512, split_by="paragraph")

        # è¯»å–æ–‡æœ¬å­—ç¬¦ä¸²
        documents = await reader(
            text=(
                # æˆ‘ä»¬å‡†å¤‡ä¸€äº›æ–‡æœ¬æ•°æ®ç”¨äºæ¼”ç¤º RAG åŠŸèƒ½ã€‚
                "æˆ‘çš„åå­—æ˜¯ææ˜ï¼Œä»Šå¹´28å²ã€‚\n"
                "æˆ‘å±…ä½åœ¨ä¸­å›½æ­å·ï¼Œæ˜¯ä¸€åç®—æ³•å·¥ç¨‹å¸ˆã€‚æˆ‘å–œæ¬¢æ‰“ç¯®çƒå’Œç©æ¸¸æˆã€‚\n"
                "æˆ‘çˆ¶äº²çš„åå­—æ˜¯æå¼ºï¼Œæ˜¯ä¸€ååŒ»ç”Ÿï¼Œæˆ‘çš„æ¯äº²æ˜¯é™ˆèŠ³èŠ³ï¼Œæ˜¯ä¸€åæ•™å¸ˆï¼Œå¥¹æ€»æ˜¯æŒ‡å¯¼æˆ‘å­¦ä¹ ã€‚\n"
                "æˆ‘ç°åœ¨åœ¨åŒ—äº¬å¤§å­¦æ”»è¯»åšå£«å­¦ä½ï¼Œç ”ç©¶æ–¹å‘æ˜¯äººå·¥æ™ºèƒ½ã€‚\n"
                "æˆ‘æœ€å¥½çš„æœ‹å‹æ˜¯ç‹ä¼Ÿï¼Œæˆ‘ä»¬ä»å°ä¸€èµ·é•¿å¤§ï¼Œç°åœ¨ä»–æ˜¯ä¸€åå¾‹å¸ˆã€‚"
            ),
        )

        if print_docs:
            print(f"æ–‡æœ¬è¢«åˆ†å—ä¸º {len(documents)} ä¸ª Document å¯¹è±¡ï¼š")
            for idx, doc in enumerate(documents):
                print(f"Document {idx}:")
                print("\tScore: ", doc.score)
                print(
                    "\tMetadata: ",
                    json.dumps(doc.metadata, indent=2, ensure_ascii=False),
                    "\n",
                )

        return documents


    docs = asyncio.run(example_text_reader(print_docs=True))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    æ–‡æœ¬è¢«åˆ†å—ä¸º 5 ä¸ª Document å¯¹è±¡ï¼š
    Document 0:
            Score:  None
            Metadata:  {
      "content": {
        "type": "text",
        "text": "æˆ‘çš„åå­—æ˜¯ææ˜ï¼Œä»Šå¹´28å²ã€‚"
      },
      "doc_id": "547e45879e96438c19ddb0f06bcf750ead3cc20e079458880f3533bcb2300a13",
      "chunk_id": 0,
      "total_chunks": 5
    } 

    Document 1:
            Score:  None
            Metadata:  {
      "content": {
        "type": "text",
        "text": "æˆ‘å±…ä½åœ¨ä¸­å›½æ­å·ï¼Œæ˜¯ä¸€åç®—æ³•å·¥ç¨‹å¸ˆã€‚æˆ‘å–œæ¬¢æ‰“ç¯®çƒå’Œç©æ¸¸æˆã€‚"
      },
      "doc_id": "547e45879e96438c19ddb0f06bcf750ead3cc20e079458880f3533bcb2300a13",
      "chunk_id": 1,
      "total_chunks": 5
    } 

    Document 2:
            Score:  None
            Metadata:  {
      "content": {
        "type": "text",
        "text": "æˆ‘çˆ¶äº²çš„åå­—æ˜¯æå¼ºï¼Œæ˜¯ä¸€ååŒ»ç”Ÿï¼Œæˆ‘çš„æ¯äº²æ˜¯é™ˆèŠ³èŠ³ï¼Œæ˜¯ä¸€åæ•™å¸ˆï¼Œå¥¹æ€»æ˜¯æŒ‡å¯¼æˆ‘å­¦ä¹ ã€‚"
      },
      "doc_id": "547e45879e96438c19ddb0f06bcf750ead3cc20e079458880f3533bcb2300a13",
      "chunk_id": 2,
      "total_chunks": 5
    } 

    Document 3:
            Score:  None
            Metadata:  {
      "content": {
        "type": "text",
        "text": "æˆ‘ç°åœ¨åœ¨åŒ—äº¬å¤§å­¦æ”»è¯»åšå£«å­¦ä½ï¼Œç ”ç©¶æ–¹å‘æ˜¯äººå·¥æ™ºèƒ½ã€‚"
      },
      "doc_id": "547e45879e96438c19ddb0f06bcf750ead3cc20e079458880f3533bcb2300a13",
      "chunk_id": 3,
      "total_chunks": 5
    } 

    Document 4:
            Score:  None
            Metadata:  {
      "content": {
        "type": "text",
        "text": "æˆ‘æœ€å¥½çš„æœ‹å‹æ˜¯ç‹ä¼Ÿï¼Œæˆ‘ä»¬ä»å°ä¸€èµ·é•¿å¤§ï¼Œç°åœ¨ä»–æ˜¯ä¸€åå¾‹å¸ˆã€‚"
      },
      "doc_id": "547e45879e96438c19ddb0f06bcf750ead3cc20e079458880f3533bcb2300a13",
      "chunk_id": 4,
      "total_chunks": 5
    } 





.. GENERATED FROM PYTHON SOURCE LINES 128-142

ç”±äºå¹¶ä¸å­˜åœ¨ä¸€ä¸ª â€œone-for-allâ€ çš„æ•°æ®è¯»å–å’Œåˆ†å—æ–¹æ³•ï¼Œç‰¹åˆ«åƒæ˜¯ PDF å’Œ Word è¿™ç±»å¤æ‚æ ¼å¼çš„æ–‡æ¡£ã€‚
å› æ­¤ï¼ŒAgentScope é¼“åŠ±å¼€å‘è€…æ ¹æ®è‡ªå·±çš„æ•°æ®æ ¼å¼å®ç°è‡ªå®šä¹‰çš„ readerã€‚
åªéœ€è¦ç»§æ‰¿ ``BaseReader`` ç±»ï¼Œå¹¶å®ç° ``__call__`` æ–¹æ³•å³å¯ã€‚

åœ¨æ•°æ®åˆ†å—åï¼Œæ¥ä¸‹æ¥éœ€è¦å°†æ•°æ®å—æ·»åŠ åˆ°çŸ¥è¯†åº“ä¸­ã€‚
åœ¨ AgentScope ä¸­ï¼ŒçŸ¥è¯†åº“çš„åˆå§‹åŒ–éœ€è¦æä¾› **åµŒå…¥æ¨¡å‹** å’Œ **å‘é‡å­˜å‚¨** ï¼ˆå³å‘é‡æ•°æ®åº“ï¼‰ çš„å¯¹è±¡ã€‚
AgentScope ç›®å‰å†…ç½®æ”¯æŒåŸºäº `Qdrant <https://qdrant.tech/>`_ å®ç°çš„å‘é‡å­˜å‚¨ï¼Œä»¥åŠä¸€ä¸ªçŸ¥è¯†åº“çš„åŸºç¡€å®ç° ``SimpleKnowledge``ã€‚
å…·ä½“ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

.. note::

 - æˆ‘ä»¬æ­£åœ¨ AgentScope ä¸­é›†æˆæ–°çš„å‘é‡æ•°æ®åº“ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹æˆ‘ä»¬çš„ `å¼€å‘è·¯çº¿å›¾ <https://github.com/orgs/agentscope-ai/projects/2>`_ã€‚æ¬¢è¿è´¡çŒ®ä»£ç ï¼
 - Qdrant çš„å®ç°é€šè¿‡ ``location`` å‚æ•°æ”¯æŒå¤šç§ä¸åŒçš„éƒ¨ç½²æ–¹å¼ï¼ŒåŒ…æ‹¬å†…å­˜æ¨¡å¼ï¼Œæœ¬åœ°æ¨¡å¼å’Œäº‘ç«¯æ¨¡å¼ã€‚è¯¦æƒ…è¯·å‚è€ƒ `Qdrant æ–‡æ¡£ <https://qdrant.tech/>`_ã€‚


.. GENERATED FROM PYTHON SOURCE LINES 142-184

.. code-block:: Python



    async def build_knowledge_base() -> SimpleKnowledge:
        """æ„å»ºçŸ¥è¯†åº“ã€‚"""
        # è¯»å– documents æ•°æ®
        documents = await example_text_reader(print_docs=False)

        # åˆ›å»ºä¸€ä¸ªå†…å­˜ä¸­çš„ Qdrant å‘é‡å­˜å‚¨ï¼Œä»¥åŠä½¿ç”¨ DashScopeTextEmbedding ä½œä¸ºåµŒå…¥æ¨¡å‹ï¼Œåˆå§‹åŒ–çŸ¥è¯†åº“
        knowledge = SimpleKnowledge(
            # æä¾›ä¸€ä¸ª embedding æ¨¡å‹ç”¨äºå°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡
            embedding_model=DashScopeTextEmbedding(
                api_key=os.environ["DASHSCOPE_API_KEY"],
                model_name="text-embedding-v4",
                dimensions=1024,
            ),
            # é€‰æ‹© Qdrant ä½œä¸ºå‘é‡å­˜å‚¨
            embedding_store=QdrantStore(
                location=":memory:",  # ä½¿ç”¨å†…å­˜æ¨¡å¼
                collection_name="test_collection",
                dimensions=1024,  # åµŒå…¥å‘é‡çš„ç»´åº¦å¿…é¡»ä¸åµŒå…¥æ¨¡å‹è¾“å‡ºçš„ç»´åº¦ä¸€è‡´
            ),
        )

        # å°† documents æ·»åŠ åˆ°çŸ¥è¯†åº“ä¸­
        await knowledge.add_documents(documents)

        # ä»çŸ¥è¯†åº“ä¸­æ£€ç´¢æ•°æ®
        docs = await knowledge.retrieve(
            query="ææ˜çš„çˆ¶äº²æ˜¯è°ï¼Ÿ",
            limit=3,
            score_threshold=0.5,
        )

        print("æ£€ç´¢åˆ°çš„ Document å¯¹è±¡ï¼š")
        for doc in docs:
            print(doc, "\n")

        return knowledge


    knowledge = asyncio.run(build_knowledge_base())





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    æ£€ç´¢åˆ°çš„ Document å¯¹è±¡ï¼š
    Document(metadata=DocMetadata(content={'type': 'text', 'text': 'æˆ‘çˆ¶äº²çš„åå­—æ˜¯æå¼ºï¼Œæ˜¯ä¸€ååŒ»ç”Ÿï¼Œæˆ‘çš„æ¯äº²æ˜¯é™ˆèŠ³èŠ³ï¼Œæ˜¯ä¸€åæ•™å¸ˆï¼Œå¥¹æ€»æ˜¯æŒ‡å¯¼æˆ‘å­¦ä¹ ã€‚'}, doc_id='547e45879e96438c19ddb0f06bcf750ead3cc20e079458880f3533bcb2300a13', chunk_id=2, total_chunks=5), id='AxMS7nphuaCU67HCyHmriP', embedding=None, score=0.5971063116560947) 

    Document(metadata=DocMetadata(content={'type': 'text', 'text': 'æˆ‘çš„åå­—æ˜¯ææ˜ï¼Œä»Šå¹´28å²ã€‚'}, doc_id='547e45879e96438c19ddb0f06bcf750ead3cc20e079458880f3533bcb2300a13', chunk_id=0, total_chunks=5), id='FnLWsKf2PgXMCSk8NHYTSe', embedding=None, score=0.5449764333507582) 





.. GENERATED FROM PYTHON SOURCE LINES 185-225

AgentScope ä¸­çš„çŸ¥è¯†åº“ç±»æä¾›ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼š``add_documents`` å’Œ ``retrieve``ï¼Œåˆ†åˆ«ç”¨äºæ·»åŠ æ•°æ®å—å’Œæœç´¢æ£€ç´¢æ•°æ®å—ã€‚

æ­¤å¤–ï¼ŒAgentScope æä¾›äº† ``retrieve_knowledge`` æ–¹æ³•ï¼Œå®ƒå°† ``retrieve`` æ–¹æ³•å°è£…æˆä¸€ä¸ªæ™ºèƒ½ä½“èƒ½å¤Ÿç›´æ¥è°ƒç”¨çš„å·¥å…·å‡½æ•°ã€‚å¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥å·¥å…·å‡½æ•°è£…å¤‡æ™ºèƒ½ä½“ã€‚

è‡ªå®šä¹‰ RAG ç»„ä»¶
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
AgentScope æ”¯æŒå¹¶é¼“åŠ±å¼€å‘è€…è‡ªå®šä¹‰ RAG ç»„ä»¶ï¼ŒåŒ…æ‹¬ readerã€çŸ¥è¯†åº“å’Œå‘é‡æ•°æ®åº“ã€‚
å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬æä¾›äº†ä»¥ä¸‹åŸºç±»ç”¨äºè‡ªå®šä¹‰ï¼š

.. list-table:: RAG åŸºç±»
    :header-rows: 1

    * - åŸºç±»
      - æè¿°
      - æŠ½è±¡æ–¹æ³•
    * - ``ReaderBase``
      - æ‰€æœ‰ reader çš„åŸºç±»
      - ``__call__``
    * - ``VDBStoreBase``
      - å‘é‡æ•°æ®åº“çš„åŸºç±»
      - | ``add``
        | ``search``
        | ``get_client`` (å¯é€‰)
        | ``delete`` (å¯é€‰)
    * - ``KnowledgeBase``
      - çŸ¥è¯†åº“çš„åŸºç±»
      - | ``retrieve``
        | ``add_documents``

``VDBStoreBase`` ä¸­çš„ ``get_client`` æ–¹æ³•å…è®¸å¼€å‘è€…è®¿é—®åº•å±‚å‘é‡æ•°æ®åº“çš„å®Œæ•´åŠŸèƒ½ã€‚
è¿™æ ·ï¼Œä»–ä»¬å°±å¯ä»¥åŸºäºå‘é‡æ•°æ®åº“å®ç°æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å»ºç«‹ç´¢å¼•ã€é«˜çº§æœç´¢ç­‰ã€‚

ä¸ ReActAgent é›†æˆ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ¼”ç¤ºå¦‚ä½•ä»¥æ™ºèƒ½ä½“è‡ªä¸»æ§åˆ¶ï¼ˆagenticï¼‰å’Œé€šç”¨ï¼ˆgenericï¼‰ä¸¤ç§æ–¹å¼å°† RAG æ¨¡å—ä¸ AgentScope ä¸­çš„ ``ReActAgent`` é›†æˆã€‚

æ™ºèƒ½ä½“è‡ªä¸»æ§åˆ¶
--------------------------------
åœ¨æ™ºèƒ½ä½“è‡ªä¸»æ§åˆ¶çš„æ–¹å¼ä¸­ï¼ŒReAct æ™ºèƒ½ä½“å¯ä»¥è‡ªä¸»å†³å®šä½•æ—¶æ£€ç´¢çŸ¥è¯†ä»¥åŠæ£€ç´¢çš„æŸ¥è¯¢å†…å®¹ã€‚
å°† RAG æ¨¡å—ä¸ AgentScope ä¸­çš„ ``ReActAgent`` é›†æˆéå¸¸ç®€å•ï¼Œåªéœ€å°†çŸ¥è¯†åº“çš„ ``retrieve_knowledge`` æ–¹æ³•æ³¨å†Œä¸ºå·¥å…·ï¼Œå¹¶ä¸ºè¯¥å·¥å…·æä¾›é€‚å½“çš„æè¿°å³å¯ã€‚

.. GENERATED FROM PYTHON SOURCE LINES 225-276

.. code-block:: Python



    async def example_agentic_manner() -> None:
        """ä»¥æ™ºèƒ½ä½“è‡ªä¸»æ§åˆ¶æ–¹å¼å°† RAG æ¨¡å—ä¸ ReActAgent é›†æˆçš„ç¤ºä¾‹ã€‚"""
        # åˆ›å»ºä¸€ä¸ª ReAct æ™ºèƒ½ä½“
        toolkit = Toolkit()

        # ä½¿ç”¨ DashScope ä½œä¸ºæ¨¡å‹åˆ›å»º ReAct æ™ºèƒ½ä½“
        agent = ReActAgent(
            name="Friday",
            sys_prompt="You're a helpful assistant named Friday.",
            model=DashScopeChatModel(
                api_key=os.environ["DASHSCOPE_API_KEY"],
                model_name="qwen-max",
            ),
            formatter=DashScopeChatFormatter(),
            toolkit=toolkit,
        )

        print("ç¬¬ä¸€æ¬¡å›å¤: ")
        # ç¬¬ä¸€æ¬¡æˆ‘ä»¬è¿›è¡Œä¸€äº›äº¤æµï¼Œæä¾›â€œææ˜â€è¿™ä¸ªåå­—ä½œä¸ºä¸Šä¸‹æ–‡å†…å®¹
        await agent(
            Msg(
                "user",
                "ææ˜æ˜¯æˆ‘æœ€å¥½çš„æœ‹å‹ã€‚",
                "user",
            ),
        )

        # å°† retrieve_knowledge æ–¹æ³•æ³¨å†Œä¸ºå·¥å…·ç®±ä¸­çš„å·¥å…·å‡½æ•°
        toolkit.register_tool_function(
            knowledge.retrieve_knowledge,
            func_description=(  # ä¸ºå·¥å…·æä¾›æ¸…æ™°çš„æè¿°
                "ç”¨äºæ£€ç´¢ä¸ç»™å®šæŸ¥è¯¢ç›¸å…³çš„æ–‡æ¡£çš„å·¥å…·ã€‚" "å½“ä½ éœ€è¦æŸ¥æ‰¾æœ‰å…³ææ˜çš„ä¿¡æ¯æ—¶ä½¿ç”¨æ­¤å·¥å…·ã€‚"
            ),
        )

        print("\n\nç¬¬äºŒæ¬¡å›å¤: ")
        # ç¬¬äºŒæ¬¡å›å¤ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æ™ºèƒ½ä½“èƒ½å¤Ÿå°†æŸ¥è¯¢ä¸­â€œä»–çˆ¶äº²â€æ”¹å†™å¾—æ›´å…·ä½“ï¼Œä¾‹å¦‚
        # â€œææ˜çš„çˆ¶äº²æ˜¯è°ï¼Ÿâ€æˆ–â€œææ˜çš„çˆ¶äº²â€
        await agent(
            Msg(
                "user",
                "ä½ çŸ¥é“ä»–çˆ¶äº²æ˜¯è°å—ï¼Ÿ",
                "user",
            ),
        )


    asyncio.run(example_agentic_manner())





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    ç¬¬ä¸€æ¬¡å›å¤: 
    Friday: é‚£å¾ˆå¥½å•Šï¼æœ‰å¥½æœ‹å‹æ˜¯ä¸€ä»¶å¾ˆå¹¸ç¦çš„äº‹æƒ…ã€‚ä½ å’Œææ˜æ˜¯æ€ä¹ˆè®¤è¯†çš„ï¼Ÿä½ ä»¬ä¹‹é—´æœ‰ä»€ä¹ˆå…±åŒçš„å…´è¶£çˆ±å¥½å—ï¼Ÿ


    ç¬¬äºŒæ¬¡å›å¤: 
    Friday: {
        "type": "tool_use",
        "id": "call_fc593afd0217463ab01770",
        "name": "retrieve_knowledge",
        "input": {
            "query": "ææ˜çš„çˆ¶äº²"
        },
        "raw_input": "{\"query\": \"ææ˜çš„çˆ¶äº²\"}"
    }
    system: {
        "type": "tool_result",
        "id": "call_fc593afd0217463ab01770",
        "name": "retrieve_knowledge",
        "output": [
            {
                "type": "text",
                "text": "Score: 0.5874060786403573, Content: æˆ‘çˆ¶äº²çš„åå­—æ˜¯æå¼ºï¼Œæ˜¯ä¸€ååŒ»ç”Ÿï¼Œæˆ‘çš„æ¯äº²æ˜¯é™ˆèŠ³èŠ³ï¼Œæ˜¯ä¸€åæ•™å¸ˆï¼Œå¥¹æ€»æ˜¯æŒ‡å¯¼æˆ‘å­¦ä¹ ã€‚"
            },
            {
                "type": "text",
                "text": "Score: 0.5298775693077571, Content: æˆ‘çš„åå­—æ˜¯ææ˜ï¼Œä»Šå¹´28å²ã€‚"
            },
            {
                "type": "text",
                "text": "Score: 0.4109046508059505, Content: æˆ‘æœ€å¥½çš„æœ‹å‹æ˜¯ç‹ä¼Ÿï¼Œæˆ‘ä»¬ä»å°ä¸€èµ·é•¿å¤§ï¼Œç°åœ¨ä»–æ˜¯ä¸€åå¾‹å¸ˆã€‚"
            },
            {
                "type": "text",
                "text": "Score: 0.3137894297688633, Content: æˆ‘ç°åœ¨åœ¨åŒ—äº¬å¤§å­¦æ”»è¯»åšå£«å­¦ä½ï¼Œç ”ç©¶æ–¹å‘æ˜¯äººå·¥æ™ºèƒ½ã€‚"
            },
            {
                "type": "text",
                "text": "Score: 0.30488523710847326, Content: æˆ‘å±…ä½åœ¨ä¸­å›½æ­å·ï¼Œæ˜¯ä¸€åç®—æ³•å·¥ç¨‹å¸ˆã€‚æˆ‘å–œæ¬¢æ‰“ç¯®çƒå’Œç©æ¸¸æˆã€‚"
            }
        ]
    }
    Friday: æ ¹æ®æˆ‘æ‰¾åˆ°çš„ä¿¡æ¯ï¼Œææ˜çš„çˆ¶äº²åå«æå¼ºï¼Œä»–æ˜¯ä¸€ååŒ»ç”Ÿã€‚å¦‚æœè¿™ä¸ªä¿¡æ¯ä¸ä½ æ‰€çŸ¥çš„æƒ…å†µä¸ç¬¦ï¼Œå¯èƒ½æ˜¯ç”±äºå­˜åœ¨å¤šä¸ªåŒåçš„äººæˆ–è€…ä¿¡æ¯æœ‰æ‰€æ›´æ–°ã€‚ä½ æœ‰å…¶ä»–å…³äºææ˜çš„é—®é¢˜éœ€è¦äº†è§£å—ï¼Ÿ




.. GENERATED FROM PYTHON SOURCE LINES 277-290

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†æ­£å¸¸ä¸æ™ºèƒ½ä½“äº¤æµè¿‡ç¨‹ã€‚ç¬¬ä¸€æ¬¡çš„äº¤æµæˆ‘ä»¬æä¾›äº†â€œææ˜â€çš„åå­—ä½œä¸ºä¸Šä¸‹æ–‡å†…å®¹ã€‚
ç¬¬äºŒæ¬¡æé—®æ—¶ï¼Œæˆ‘ä»¬çš„é—®é¢˜æ˜¯â€œä½ çŸ¥é“ä»–çˆ¶äº²æ˜¯è°å—ï¼Ÿâ€ï¼Œ
æˆ‘ä»¬å¸Œæœ›æ™ºèƒ½ä½“èƒ½å¤Ÿåˆ©ç”¨ä¸Šä¸‹æ–‡å†å²ä¿¡æ¯æ”¹å†™æŸ¥è¯¢ï¼Œä½¿å…¶æ›´å…·ä½“ï¼Œæ›´å¥½çš„è¿›è¡Œæ£€ç´¢ï¼Œä¾‹å¦‚æ”¹å†™ä¸ºâ€œææ˜çš„çˆ¶äº²æ˜¯è°ï¼Ÿâ€æˆ–â€œææ˜çš„çˆ¶äº²â€ã€‚

æ›´è¿›ä¸€æ­¥ï¼Œç»“åˆ :ref:`plan` æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥è®©æ™ºèƒ½ä½“å®ç°æ›´åŠ å¤æ‚çš„æŸ¥è¯¢æ”¹å†™å’Œå¤šè½®æ£€ç´¢ã€‚

é€šç”¨æ–¹å¼
--------------------------------
``ReActAgent`` è¿˜ä»¥ä¸€ç§æ›´åŠ é€šç”¨çš„æ–¹å¼é›†æˆäº† RAG æ¨¡å—ï¼Œ
å®ƒåœ¨æ¯æ¬¡ ``reply`` å‡½æ•°å¼€å§‹æ‰§è¡Œæ—¶æ£€ç´¢çŸ¥è¯†ï¼Œå¹¶å°†æ£€ç´¢åˆ°çš„çŸ¥è¯†é™„åŠ åˆ°ç”¨æˆ·æ¶ˆæ¯çš„æç¤ºä¸­ã€‚

åªéœ€è®¾ç½® ``ReActAgent`` çš„ ``knowledge`` å‚æ•°ï¼Œæ™ºèƒ½ä½“å°±ä¼šåœ¨æ¯æ¬¡å›å¤å¼€å§‹æ—¶è‡ªåŠ¨æ£€ç´¢çŸ¥è¯†ã€‚


.. GENERATED FROM PYTHON SOURCE LINES 290-323

.. code-block:: Python



    async def example_generic_manner() -> None:
        """ä»¥é€šç”¨æ–¹å¼å°† RAG æ¨¡å—ä¸ ReActAgent é›†æˆçš„ç¤ºä¾‹ã€‚"""
        # åˆ›å»ºä¸€ä¸ª ReAct æ™ºèƒ½ä½“
        agent = ReActAgent(
            name="Friday",
            sys_prompt="You're a helpful assistant named Friday.",
            model=DashScopeChatModel(
                api_key=os.environ["DASHSCOPE_API_KEY"],
                model_name="qwen-max",
            ),
            formatter=DashScopeChatFormatter(),
            # å°†çŸ¥è¯†åº“ä¼ é€’ç»™æ™ºèƒ½ä½“
            knowledge=knowledge,
        )

        await agent(
            Msg(
                "user",
                "ä½ çŸ¥é“ææ˜çš„çˆ¶äº²æ˜¯è°å—ï¼Ÿ",
                "user",
            ),
        )

        print("\næŸ¥çœ‹æ™ºèƒ½ä½“è®°å¿†ä¸­æ£€ç´¢ä¿¡æ¯å¦‚ä½•æ’å…¥ï¼š")
        content = (await agent.memory.get_memory())[1].content
        print(json.dumps(content, indent=2, ensure_ascii=False))


    asyncio.run(example_generic_manner())






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Friday: æ ¹æ®ä½ æä¾›çš„ä¿¡æ¯ï¼Œææ˜çš„çˆ¶äº²åå«æå¼ºï¼Œä»–æ˜¯ä¸€ååŒ»ç”Ÿã€‚

    æŸ¥çœ‹æ™ºèƒ½ä½“è®°å¿†ä¸­æ£€ç´¢ä¿¡æ¯å¦‚ä½•æ’å…¥ï¼š
    [
      {
        "type": "text",
        "text": "<retrieved_knowledge>Use the following content from the knowledge base(s) if it's helpful:\n"
      },
      {
        "type": "text",
        "text": "æˆ‘çˆ¶äº²çš„åå­—æ˜¯æå¼ºï¼Œæ˜¯ä¸€ååŒ»ç”Ÿï¼Œæˆ‘çš„æ¯äº²æ˜¯é™ˆèŠ³èŠ³ï¼Œæ˜¯ä¸€åæ•™å¸ˆï¼Œå¥¹æ€»æ˜¯æŒ‡å¯¼æˆ‘å­¦ä¹ ã€‚"
      },
      {
        "type": "text",
        "text": "æˆ‘çš„åå­—æ˜¯ææ˜ï¼Œä»Šå¹´28å²ã€‚"
      },
      {
        "type": "text",
        "text": "æˆ‘æœ€å¥½çš„æœ‹å‹æ˜¯ç‹ä¼Ÿï¼Œæˆ‘ä»¬ä»å°ä¸€èµ·é•¿å¤§ï¼Œç°åœ¨ä»–æ˜¯ä¸€åå¾‹å¸ˆã€‚"
      },
      {
        "type": "text",
        "text": "æˆ‘å±…ä½åœ¨ä¸­å›½æ­å·ï¼Œæ˜¯ä¸€åç®—æ³•å·¥ç¨‹å¸ˆã€‚æˆ‘å–œæ¬¢æ‰“ç¯®çƒå’Œç©æ¸¸æˆã€‚"
      },
      {
        "type": "text",
        "text": "æˆ‘ç°åœ¨åœ¨åŒ—äº¬å¤§å­¦æ”»è¯»åšå£«å­¦ä½ï¼Œç ”ç©¶æ–¹å‘æ˜¯äººå·¥æ™ºèƒ½ã€‚"
      },
      {
        "type": "text",
        "text": "</retrieved_knowledge>"
      }
    ]




.. GENERATED FROM PYTHON SOURCE LINES 324-334

å¤šæ¨¡æ€ RAG
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
AgentScope ä¸­çš„ RAG æ¨¡å—åŸç”Ÿæ”¯æŒå¤šæ¨¡æ€ï¼Œå› ä¸º

- AgentScope æ”¯æŒå¤šæ¨¡æ€åµŒå…¥ APIï¼Œä¾‹å¦‚ ``DashScopeMultimodalEmbedding``ã€‚
- ``Document`` ç±»çš„ ``metadata`` ä¸­ï¼Œ``content`` å­—æ®µçš„ç±»å‹æ˜¯ ``TextBlock | ImageBlock | VideoBlock``ï¼Œå› æ­¤å¯ä»¥å­˜å‚¨æ–‡æœ¬ã€å›¾ç‰‡å’Œè§†é¢‘ç­‰å¤šæ¨¡æ€æ•°æ®ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å¤šæ¨¡æ€ reader å’ŒåµŒå…¥æ¨¡å‹æ¥æ„å»ºå¤šæ¨¡æ€çŸ¥è¯†åº“ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å‡†å¤‡ä¸€å¼ æœ¬åœ°çš„å›¾ç‰‡ï¼Œè¿™å¼ å›¾ç‰‡ä¸ŠåŒ…å«äº†æ–‡æœ¬â€œMy name is Ming Liâ€ã€‚

.. GENERATED FROM PYTHON SOURCE LINES 334-343

.. code-block:: Python


    # å‡†å¤‡ä¸€å¼ åŒ…å«æ–‡æœ¬â€œMy name is Ming Liâ€çš„å›¾ç‰‡ã€‚
    path_image = "./example.png"
    plt.figure(figsize=(8, 3))
    plt.text(0.5, 0.5, "My name is Ming Li", ha="center", va="center", fontsize=30)
    plt.axis("off")
    plt.savefig(path_image, bbox_inches="tight", pad_inches=0.1)
    plt.close()








.. GENERATED FROM PYTHON SOURCE LINES 344-348

ç„¶åæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªå¤šæ¨¡æ€çŸ¥è¯†åº“ï¼Œæ„å»ºè¿‡ç¨‹ä¸çº¯æ–‡æœ¬çŸ¥è¯†åº“ç±»ä¼¼ã€‚åªæ˜¯å°† reader å’ŒåµŒå…¥æ¨¡å‹æ›¿æ¢ä¸ºå¤šæ¨¡æ€ç‰ˆæœ¬å³å¯ã€‚
åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† ``ImageReader`` å’Œ ``DashScopeMultiModalEmbedding``ã€‚
åŒæ—¶ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å¤šæ¨¡æ€æ¨¡å‹ ``qwen3-vl-plus`` ä½œä¸ºæ™ºèƒ½ä½“çš„è¯­è¨€æ¨¡å‹ã€‚


.. GENERATED FROM PYTHON SOURCE LINES 348-399

.. code-block:: Python



    async def example_multimodal_rag() -> None:
        """ä½¿ç”¨å¤šæ¨¡æ€ RAG çš„ç¤ºä¾‹ã€‚"""
        # ä½¿ç”¨ ImageReader è¯»å–å›¾ç‰‡
        reader = ImageReader()
        docs = await reader(image_url=path_image)

        # åˆ›å»ºä¸€ä¸ªçŸ¥è¯†åº“
        knowledge = SimpleKnowledge(
            embedding_model=DashScopeMultiModalEmbedding(
                api_key=os.environ["DASHSCOPE_API_KEY"],
                model_name="multimodal-embedding-v1",
                dimensions=1024,
            ),
            embedding_store=QdrantStore(
                location=":memory:",
                collection_name="test_collection",
                dimensions=1024,
            ),
        )

        await knowledge.add_documents(docs)

        agent = ReActAgent(
            name="Friday",
            sys_prompt="You're a helpful assistant named Friday.",
            model=DashScopeChatModel(
                api_key=os.environ["DASHSCOPE_API_KEY"],
                model_name="qwen3-vl-plus",
            ),
            formatter=DashScopeChatFormatter(),
            knowledge=knowledge,
        )

        await agent(
            Msg(
                "user",
                "ä½ çŸ¥é“æˆ‘çš„åå­—å—ï¼Ÿ",
                "user",
            ),
        )

        # è®©æˆ‘ä»¬çœ‹çœ‹æ£€ç´¢åˆ°çš„å›¾ç‰‡æ•°æ®æ˜¯å¦å·²ç»åŠ å…¥äº†æ™ºèƒ½ä½“çš„è®°å¿†ä¸­
        print("\næŸ¥çœ‹æ™ºèƒ½ä½“è®°å¿†ä¸­æ£€ç´¢ä¿¡æ¯å¦‚ä½•æ’å…¥ï¼š")
        content = (await agent.memory.get_memory())[1].content
        print(json.dumps(content, indent=2, ensure_ascii=False))


    asyncio.run(example_multimodal_rag())





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Friday: ä½ å¥½ï¼ŒMing Liï¼ğŸ˜Š  
    å¾ˆé«˜å…´è®¤è¯†ä½ ï½ æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ

    æŸ¥çœ‹æ™ºèƒ½ä½“è®°å¿†ä¸­æ£€ç´¢ä¿¡æ¯å¦‚ä½•æ’å…¥ï¼š
    [
      {
        "type": "text",
        "text": "<retrieved_knowledge>Use the following content from the knowledge base(s) if it's helpful:\n"
      },
      {
        "type": "image",
        "source": {
          "type": "url",
          "url": "./example.png"
        }
      },
      {
        "type": "text",
        "text": "</retrieved_knowledge>"
      }
    ]




.. GENERATED FROM PYTHON SOURCE LINES 400-405

è¿›ä¸€æ­¥é˜…è¯»
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
- :ref:`embedding`
- :ref:`plan`



.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 25.843 seconds)


.. _sphx_glr_download_tutorial_task_rag.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: task_rag.ipynb <task_rag.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: task_rag.py <task_rag.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: task_rag.zip <task_rag.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
