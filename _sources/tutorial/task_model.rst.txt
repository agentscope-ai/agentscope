
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "tutorial/task_model.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_tutorial_task_model.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_tutorial_task_model.py:


.. _model:

Model
====================

In this tutorial, we introduce the model APIs integrated in AgentScope, how to use them and how to integrate new model APIs.
The supported model APIs and providers include:

.. list-table::
    :header-rows: 1

    * - API
      - Class
      - Compatible
      - Streaming
      - Tools
      - Vision
      - Reasoning
    * - OpenAI
      - ``OpenAIChatModel``
      - vLLM, DeepSeek
      - âœ…
      - âœ…
      - âœ…
      - âœ…
    * - DashScope
      - ``DashScopeChatModel``
      -
      - âœ…
      - âœ…
      - âœ…
      - âœ…
    * - Anthropic
      - ``AnthropicChatModel``
      -
      - âœ…
      - âœ…
      - âœ…
      - âœ…
    * - Gemini
      - ``GeminiChatModel``
      -
      - âœ…
      - âœ…
      - âœ…
      - âœ…
    * - Ollama
      - ``OllamaChatModel``
      -
      - âœ…
      - âœ…
      - âœ…
      - âœ…

.. note:: When using vLLM, you need to configure the appropriate tool calling parameters for different models during deployment, such as ``--enable-auto-tool-choice``, ``--tool-call-parser``, etc. For more details, refer to the `official vLLM documentation <https://docs.vllm.ai/en/latest/features/tool_calling.html>`_.

.. note:: For OpenAI-compatible models (e.g. vLLM, Deepseek), developers can use the ``OpenAIChatModel`` class, and specify the API endpoint by the ``client_kwargs`` parameter: ``client_kwargs={"base_url": "http://your-api-endpoint"}``. For example:

    .. code-block:: python

        OpenAIChatModel(client_kwargs={"base_url": "http://localhost:8000/v1"})

.. note:: Model behavior parameters (such as temperature, maximum length, etc.) can be preset in the constructor function via the ``generate_kwargs`` parameter. For example:

    .. code-block:: python

        OpenAIChatModel(generate_kwargs={"temperature": 0.3, "max_tokens": 1000})

To provide unified model interfaces, the above model classes has the following common methods:

- The first three arguments of the ``__call__`` method are ``messages`` , ``tools`` and ``tool_choice``, representing the input messages, JSON schema of tool functions, and tool selection mode, respectively.
- The return type are either a ``ChatResponse`` instance or an async generator of ``ChatResponse`` in streaming mode.

.. note:: Different model APIs differ in the input message format, refer to :ref:`prompt` for more details.

The ``ChatResponse`` instance contains the generated thinking/text/tool use content, identity, created time and usage information.

.. GENERATED FROM PYTHON SOURCE LINES 80-105

.. code-block:: Python

    import asyncio
    import json
    import os

    from agentscope.message import TextBlock, ToolUseBlock, ThinkingBlock, Msg
    from agentscope.model import ChatResponse, DashScopeChatModel

    response = ChatResponse(
        content=[
            ThinkingBlock(
                type="thinking",
                thinking="I should search for AgentScope on Google.",
            ),
            TextBlock(type="text", text="I'll search for AgentScope on Google."),
            ToolUseBlock(
                type="tool_use",
                id="642n298gjna",
                name="google_search",
                input={"query": "AgentScope?"},
            ),
        ],
    )

    print(response)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    ChatResponse(content=[{'type': 'thinking', 'thinking': 'I should search for AgentScope on Google.'}, {'type': 'text', 'text': "I'll search for AgentScope on Google."}, {'type': 'tool_use', 'id': '642n298gjna', 'name': 'google_search', 'input': {'query': 'AgentScope?'}}], id='2026-02-04 11:24:25.016_79a76a', created_at='2026-02-04 11:24:25.016', type='chat', usage=None, metadata=None)




.. GENERATED FROM PYTHON SOURCE LINES 106-107

Taking ``DashScopeChatModel`` as an example, we can use it to create a chat model instance and call it with messages and tools:

.. GENERATED FROM PYTHON SOURCE LINES 107-132

.. code-block:: Python



    async def example_model_call() -> None:
        """An example of using the DashScopeChatModel."""
        model = DashScopeChatModel(
            model_name="qwen-max",
            api_key=os.environ["DASHSCOPE_API_KEY"],
            stream=False,
        )

        res = await model(
            messages=[
                {"role": "user", "content": "Hi!"},
            ],
        )

        # You can directly create a ``Msg`` object with the response content
        msg_res = Msg("Friday", res.content, "assistant")

        print("The response:", res)
        print("The response as Msg:", msg_res)


    asyncio.run(example_model_call())





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    The response: ChatResponse(content=[{'type': 'text', 'text': 'Hello! How can I assist you today?'}], id='2026-02-04 11:24:26.724_f5ef3d', created_at='2026-02-04 11:24:26.724', type='chat', usage=ChatUsage(input_tokens=10, output_tokens=9, time=1.706827, type='chat', metadata=GenerationUsage(input_tokens=10, output_tokens=9)), metadata=None)
    The response as Msg: Msg(id='5B77Kh8hXhZ9SHzTWkJSs5', name='Friday', content=[{'type': 'text', 'text': 'Hello! How can I assist you today?'}], role='assistant', metadata=None, timestamp='2026-02-04 11:24:26.724', invocation_id='None')




.. GENERATED FROM PYTHON SOURCE LINES 133-140

Streaming
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
To enable streaming model, set the ``stream`` parameter in the model constructor to ``True``.
When streaming is enabled, the ``__call__`` method will return an **async generator** that yields ``ChatResponse`` instances as they are generated by the model.

.. note:: The streaming mode in AgentScope is designed to be **cumulative**, meaning the content in each chunk contains all the previous content plus the newly generated content.


.. GENERATED FROM PYTHON SOURCE LINES 140-170

.. code-block:: Python



    async def example_streaming() -> None:
        """An example of using the streaming model."""
        model = DashScopeChatModel(
            model_name="qwen-max",
            api_key=os.environ["DASHSCOPE_API_KEY"],
            stream=True,
        )

        generator = await model(
            messages=[
                {
                    "role": "user",
                    "content": "Count from 1 to 20, and just report the number without any other information.",
                },
            ],
        )
        print("The type of the response:", type(generator))

        i = 0
        async for chunk in generator:
            print(f"Chunk {i}")
            print(f"\ttype: {type(chunk.content)}")
            print(f"\t{chunk}\n")
            i += 1


    asyncio.run(example_streaming())





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    The type of the response: <class 'async_generator'>
    Chunk 0
            type: <class 'list'>
            ChatResponse(content=[{'type': 'text', 'text': '1'}], id='2026-02-04 11:24:28.042_552a37', created_at='2026-02-04 11:24:28.042', type='chat', usage=ChatUsage(input_tokens=27, output_tokens=1, time=1.315679, type='chat', metadata=GenerationUsage(input_tokens=27, output_tokens=1)), metadata=None)

    Chunk 1
            type: <class 'list'>
            ChatResponse(content=[{'type': 'text', 'text': '1\n2\n'}], id='2026-02-04 11:24:28.074_f18202', created_at='2026-02-04 11:24:28.074', type='chat', usage=ChatUsage(input_tokens=27, output_tokens=4, time=1.348174, type='chat', metadata=GenerationUsage(input_tokens=27, output_tokens=4)), metadata=None)

    Chunk 2
            type: <class 'list'>
            ChatResponse(content=[{'type': 'text', 'text': '1\n2\n3\n4'}], id='2026-02-04 11:24:28.116_071281', created_at='2026-02-04 11:24:28.116', type='chat', usage=ChatUsage(input_tokens=27, output_tokens=7, time=1.390576, type='chat', metadata=GenerationUsage(input_tokens=27, output_tokens=7)), metadata=None)

    Chunk 3
            type: <class 'list'>
            ChatResponse(content=[{'type': 'text', 'text': '1\n2\n3\n4\n5\n'}], id='2026-02-04 11:24:28.147_45f694', created_at='2026-02-04 11:24:28.147', type='chat', usage=ChatUsage(input_tokens=27, output_tokens=10, time=1.420728, type='chat', metadata=GenerationUsage(input_tokens=27, output_tokens=10)), metadata=None)

    Chunk 4
            type: <class 'list'>
            ChatResponse(content=[{'type': 'text', 'text': '1\n2\n3\n4\n5\n6\n7\n8\n'}], id='2026-02-04 11:24:28.243_2d1a8f', created_at='2026-02-04 11:24:28.243', type='chat', usage=ChatUsage(input_tokens=27, output_tokens=16, time=1.516736, type='chat', metadata=GenerationUsage(input_tokens=27, output_tokens=16)), metadata=None)

    Chunk 5
            type: <class 'list'>
            ChatResponse(content=[{'type': 'text', 'text': '1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n1'}], id='2026-02-04 11:24:28.342_be1d60', created_at='2026-02-04 11:24:28.343', type='chat', usage=ChatUsage(input_tokens=27, output_tokens=22, time=1.616664, type='chat', metadata=GenerationUsage(input_tokens=27, output_tokens=22)), metadata=None)

    Chunk 6
            type: <class 'list'>
            ChatResponse(content=[{'type': 'text', 'text': '1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n1'}], id='2026-02-04 11:24:28.423_97278b', created_at='2026-02-04 11:24:28.423', type='chat', usage=ChatUsage(input_tokens=27, output_tokens=28, time=1.697156, type='chat', metadata=GenerationUsage(input_tokens=27, output_tokens=28)), metadata=None)

    Chunk 7
            type: <class 'list'>
            ChatResponse(content=[{'type': 'text', 'text': '1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n1'}], id='2026-02-04 11:24:28.520_1d8174', created_at='2026-02-04 11:24:28.520', type='chat', usage=ChatUsage(input_tokens=27, output_tokens=34, time=1.794523, type='chat', metadata=GenerationUsage(input_tokens=27, output_tokens=34)), metadata=None)

    Chunk 8
            type: <class 'list'>
            ChatResponse(content=[{'type': 'text', 'text': '1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n1'}], id='2026-02-04 11:24:28.577_9a9378', created_at='2026-02-04 11:24:28.577', type='chat', usage=ChatUsage(input_tokens=27, output_tokens=40, time=1.851542, type='chat', metadata=GenerationUsage(input_tokens=27, output_tokens=40)), metadata=None)

    Chunk 9
            type: <class 'list'>
            ChatResponse(content=[{'type': 'text', 'text': '1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n1'}], id='2026-02-04 11:24:28.652_0a2e09', created_at='2026-02-04 11:24:28.652', type='chat', usage=ChatUsage(input_tokens=27, output_tokens=46, time=1.925732, type='chat', metadata=GenerationUsage(input_tokens=27, output_tokens=46)), metadata=None)

    Chunk 10
            type: <class 'list'>
            ChatResponse(content=[{'type': 'text', 'text': '1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20'}], id='2026-02-04 11:24:28.745_8d2dac', created_at='2026-02-04 11:24:28.745', type='chat', usage=ChatUsage(input_tokens=27, output_tokens=50, time=2.019572, type='chat', metadata=GenerationUsage(input_tokens=27, output_tokens=50)), metadata=None)

    Chunk 11
            type: <class 'list'>
            ChatResponse(content=[{'type': 'text', 'text': '1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20'}], id='2026-02-04 11:24:28.762_d24d4f', created_at='2026-02-04 11:24:28.762', type='chat', usage=ChatUsage(input_tokens=27, output_tokens=50, time=2.035755, type='chat', metadata=GenerationUsage(input_tokens=27, output_tokens=50)), metadata=None)





.. GENERATED FROM PYTHON SOURCE LINES 171-175

Reasoning
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
AgentScope supports reasoning models by providing the ``ThinkingBlock``.


.. GENERATED FROM PYTHON SOURCE LINES 175-200

.. code-block:: Python



    async def example_reasoning() -> None:
        """An example of using the reasoning model."""
        model = DashScopeChatModel(
            model_name="qwen-turbo",
            api_key=os.environ["DASHSCOPE_API_KEY"],
            enable_thinking=True,
        )

        res = await model(
            messages=[
                {"role": "user", "content": "Who am I?"},
            ],
        )

        last_chunk = None
        async for chunk in res:
            last_chunk = chunk
        print("The final response:")
        print(last_chunk)


    asyncio.run(example_reasoning())





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    The final response:
    ChatResponse(content=[{'type': 'thinking', 'thinking': 'Okay, the user asked "Who am I?" which is a bit vague. I need to figure out what they\'re really asking. Maybe they want to know about their identity in a philosophical sense, or perhaps they\'re looking for a personal reflection. Since I\'m an AI, I can\'t know their specific identity, but I can offer different perspectives.\n\nFirst, I should consider that the question could be about self-discovery. People often ask this when they\'re trying to understand themselves better. I can mention aspects like personal experiences, values, and relationships. But since I don\'t have access to their personal information, I need to keep it general.\n\nAnother angle is the philosophical aspect. The question "Who am I?" has been discussed by many philosophers. I can reference thinkers like Descartes or Buddha, but I should keep it concise. Also, the user might be feeling lost or seeking purpose, so offering support and encouraging self-reflection could be helpful.\n\nI should make sure my response is open-ended, allowing them to explore their own answers. Maybe ask if they want to discuss specific areas like their role in life, passions, or challenges. It\'s important to be empathetic and not assume anything about their situation. Let them know I\'m here to help them explore their identity in a way that\'s meaningful to them.'}, {'type': 'text', 'text': 'The question "Who am I?" is one of the deepest and most profound inquiries humans can make. It touches on identity, purpose, and the nature of existence. Here are a few perspectives to consider:\n\n### 1. **Philosophical Perspective**  \n   - **Ancient Wisdom**: Philosophers like Socrates ("Know thyself") and Descartes ("I think, therefore I am") emphasize self-reflection as a path to understanding. Your identity might be shaped by your thoughts, choices, and experiences.  \n   - **Eastern Thought**: In Buddhism, the concept of *anatta* (non-self) suggests that identity is fluid and not a fixed entity. Itâ€™s about observing the impermanence of the self.  \n\n### 2. **Psychological Perspective**  \n   - **Self-Concept**: Your identity is built from your beliefs, values, memories, and relationships. It evolves over time as you grow and encounter new experiences.  \n   - **Multiple Selves**: You might see yourself differently in various roles (e.g., a friend, a professional, a creative person). These facets contribute to your multifaceted identity.  \n\n### 3. **Existential Perspective**  \n   - **Freedom and Choice**: Existentialists like Jean-Paul Sartre argue that you define yourself through your actions and decisions. Your "who you are" is a product of your freedom to choose.  \n   - **Purpose**: The search for meaning often drives the question. Your identity might be tied to passions, goals, or the impact you want to have on the world.  \n\n### 4. **Spiritual or Metaphysical Perspective**  \n   - Some traditions view identity as part of a larger whole (e.g., interconnectedness with others, the universe, or a higher power). Others see it as a journey of awakening or self-realization.  \n\n### 5. **Practical Reflection**  \n   - If youâ€™re asking this now, it might be a moment of introspection. Consider:  \n     - What values guide you?  \n     - What brings you joy or fulfillment?  \n     - How do you want to be remembered?  \n     - What challenges have shaped you?  \n\n### Final Thought:  \nYou are not a fixed answer but a dynamic process. The "who you are" is shaped by your experiences, choices, and the stories you tell yourself. If youâ€™d like, we can explore this togetherâ€”what aspects of your identity feel most mysterious or important to you? ðŸŒ±'}], id='2026-02-04 11:24:41.352_e39702', created_at='2026-02-04 11:24:41.352', type='chat', usage=ChatUsage(input_tokens=12, output_tokens=787, time=12.58516, type='chat', metadata=GenerationUsage(input_tokens=12, output_tokens=787)), metadata=None)




.. GENERATED FROM PYTHON SOURCE LINES 201-209

Tools API
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Different model providers differ in their tools APIs, e.g. the tools JSON schema, the tool call/response format.
To provide a unified interface, AgentScope solves the problem by:

- Providing unified tool call block :ref:`ToolUseBlock <tool-block>` and tool response block :ref:`ToolResultBlock <tool-block>`, respectively.
- Providing a unified tools interface in the ``__call__`` method of the model classes, that accepts a list of tools JSON schemas as follows:


.. GENERATED FROM PYTHON SOURCE LINES 209-230

.. code-block:: Python


    json_schemas = [
        {
            "type": "function",
            "function": {
                "name": "google_search",
                "description": "Search for a query on Google.",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "query": {
                            "type": "string",
                            "description": "The search query.",
                        },
                    },
                    "required": ["query"],
                },
            },
        },
    ]








.. GENERATED FROM PYTHON SOURCE LINES 231-236

Further Reading
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
- :ref:`message`
- :ref:`prompt`



.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 16.338 seconds)


.. _sphx_glr_download_tutorial_task_model.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: task_model.ipynb <task_model.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: task_model.py <task_model.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: task_model.zip <task_model.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
