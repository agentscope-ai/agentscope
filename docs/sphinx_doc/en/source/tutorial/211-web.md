(211-web-en)=

# Enabling Web Browsing Ability in AgentScope

Here we introduce how we implemented the web browsing ability in AgentScope.

The two modules we implemented are simple and straightforward: a **web browser** and a **web browsing agent**.
The web browser serves as an interface to the web, and the web browsing agent, equipped with the web browser, can perform web browsing tasks given the powerful capabilities with vision-based LLM.

Note that the web browsing abilities provided in AgentScope are still in beta.
We will refine the module and provide corresponding updates both in our codebase and the documentation here.

Now, let's take a closer look at the web browser and the web browsing agent.

## Web Browser Interface

The `WebBrowser` class we implemented is a simple interface to the web. It can open a webpage, click on elements, type in elements, take screenshots, etc.
The `WebBrowser` class is implemented in [web_browser.py](https://github.com/modelscope/agentscope/blob/main/src/agentscope/browser/web_browser.py).

### Prerequisites

The `WebBrowser` class operates your browser through Playwright.
To use the web browser, you need to install the necessary Playwright packages:

- Run `pip install playwright` to set up the Python environment.
- Run `playwright install` to install the required browser for Playwright.

### Usage

The web browser we provided has simple interfaces. To use the web browser, we can simply create it and use it with the defined methods.

#### How to Create a Web Browser Instance

You can initialize the `WebBrowser` instance with the `__init__` function of `WebBrowser`:

```python
browser = WebBrowser()
```

(Optional) You can also set specific attributes of the browser instance when initializing:
- `headless`: Determines whether to run the browser in headless mode. Defaults to `False`. When set to `False`, the browser will be visible to the user.
- `timeout`: The time for the browser to wait for the page to load. Defaults to `60000`.
- `default_width`: The default width of the browser. Defaults to `1280`.
- `default_height`: The default height of the browser. Defaults to `1080`.

#### Defined Browser Interface
Currently, the defined methods of the `WebBrowser` are: `visit_page`, `crawl_page`, `click`, `type`, `scroll`, `press_key`, `close`, etc. The properties of the web browser include `url`, `page_html`, `page_title`, etc.
Due to space constraints, detailed introductions for each method interface are not provided here, but you can refer to the Sphinx API docs and inline comments for more details.
Instead, we will provide general guidance on how to use the web browser module.

#### How Does Our `WebBrowser` Work?
To use our web browser, you need to first visit a webpage, then crawl the page to retrieve elements, and finally interact with those elements.

##### Visit Webpage
**First**, you can use `browser.visit_page(url)` to start the browser with the page you are interested in. Webpage navigation can also be triggered by using the `click` or `type` method.

##### Crawl the Page
**Then**, you should call the `crawl_page` method to gather the elements of the current web page. A key feature of our web browser is that we label the interactive elements on the webpage with numbers, implemented in the `crawl_page` method. With the labeled elements, you can ensure the browser interacts with the correct elements on the page using methods like `click`, `type`, and `focus_element`. After the `crawl_page` method, the interactive elements will be labeled with numbers and stored in the `self.page_elements` property of the `WebBrowser` instance. You can then use methods like `click`, `type`, and `focus_element` to interact with these elements.

The `crawl_page` method has three input arguments and four return values. You can choose whether to use vision to add a Set-of-Marks to the webpage and whether to include the `meta_data` field in the returned formatted text.

> Set-of-Mark is a visual prompting method that partitions an image into numbered regions to improve the visual grounding ability of LLMs. You can refer to the paper https://arxiv.org/abs/2310.11441 for details. Or you can check out [our example](https://github.com/modelscope/agentscope/blob/main/examples/conversation_with_web_voyager_agent/README.md) for a demonstration.

`crawl_page` input arguments:
- `vision` (`bool`): Adds a set-of-marks to the webpage if vision is enabled and takes a screenshot. Instead of using a segmentation model, we use native JavaScript to bound the interactive elements on the webpage.
- `with_meta` (`bool`): Includes the `meta_data` field in the returned formatted text.
- `with_select` (`bool`): Returns only the selected interactive elements or all the numbered interactive elements.

`crawl_page` returns:
- `elements`: The handler from Playwright of interactive elements, also stored in the `self.page_elements` property of the `WebBrowser` instance.
- `format_ele_text`: A list of the formatted elements' text descriptions, labeled with numbers starting from zero.
- `screenshot_bytes`: The screenshot of the webpage with the Set-of-Marks, in bytes. If you want to use vision-based MLLM, save the screenshot to a file using the `file_manager` module provided and provide the image path using the format function.
- `web_ele_infos`: The info dictionary of interactive elements.

##### Perform Action
**Finally**, you can call methods like `click`, `type`, `focus_element` to interact with the labeled interactive elements, for example:

```python
browser.click(element_id)
```

```python
browser.type(element_id, "Hello, World!")
```

you can also call methods other methods like `scroll`, `press_key`, `close`. You may refer to the API documentation or the [original code](https://github.com/modelscope/agentscope/blob/main/src/agentscope/browser/web_browser.py) for more details.

### Web Browsing Agent
The `WebVoyagerAgent` we implemented is a simple agent that can perform web browsing tasks. It is implemented in [web_voyager_agent.py](https://github.com/modelscope/agentscope/blob/main/src/agentscope/agents/web_voyager_agent.py). The agent's reply function is implemented in the `reply` method of the `WebVoyagerAgent` class, and it follows these steps: 1. visit web page -> 2. crawl the page -> 3. perform action -> 4. repeat iteration until the goal is achieved.

You can try interacting with the agent in [our example](https://github.com/modelscope/agentscope/blob/main/examples/conversation_with_web_voyager_agent/). Since the module is still in beta and the agent is far from perfect, you can try to improve it or even build an agent by yourself if you are capable.

Enjoy exploring the web with our agent!

[[Back to the top]](#211-web-en)
