(211-web-en)=

# Enabling Web Browsing ability in AgentScope

We want to introduce how we implemented the web browsing ability in AgentScope.
The two modules we implemented are simple and straightforward: a web browser and a web browsing agent.
The web browser serve as an interface to the web, and the web browsing agent equiped with the web browser can perform web browsing tasks given the powerful capabilities with Vision-based LLM.

Note that the web browsing abilities provided in agentscope are still in beta. We will refine the module and provide corresponding updates both in our code base and the documentation here.

Now, let's take a look at the web browser and the web browsing agent.

## Web Browser Interface

The `WebBrowser` is a simple interface to the web. It can open a webpage, click on elements, type in elements, and take screenshots, etc.
The `WebBrowser` is implemented in [web_browser.py](https://github.com/modelscope/agentscope/blob/main/src/agentscope/browser/web_browser.py).

### Prerequisites

The `WebBrowser` class operate your browser though the Playwright. To use the web browser, you need to install the necessary Playwright packages:
- Run `pip install playwright` to set up the Python environment.
- Run `playwright install` to install the required browser for Playwright.

### Usage

The web browser we provided have simple interfaces.
To use the web browser, we can simple create it and use it with the defined methods.

#### How to create a web browser instance

We can simple init the `WebBrowser` instance with the `__init__` function of `WebBrowser`:

```python
browser = WebBrowser()
```

(Optional)You can also set specific attributes of the browser instance when init:
- headless: Whether to run the browser in headless mode. Defaults to False. When set to False, the browser will be visible to user.
- timeout: The timeout for the browser to wait for the page to load. Defaults to 60000.
- default_width: The default width of the browser. Defaults to 1280.
- default_height: The default height of the browser. Defaults to 1080.


#### The defined browser interface

Currently, the defined methods of the `WebBrowser` are:
`visit_page`, `crawl_page`, `click`, `type`, `scroll`, `press_key`, `close`, etc.

The properties of the web browser include the `url`, `page_html`, `page_title`, etc.

#### How does our web browser work?

To use our web browser, we need to first visit a webpage, then crawl the page to get the elements, and finally interact with the elements.

##### Visit webpage
**First**, you can use `browser.visit_page(url)` to start the browser with the page you interested in. Note that webpage navigation can also be triggered by the `click` or `type` method.


##### Crawl the page
**Then** you should call the `crawl_page` method to get the elements of the page.
**A key features of our web browser is we labeled the interactive elements in the webpage with numbers,** which is implemented in the `crawlpage` method. With the labeled elements, we can make sure the browser knows which element to interact with, so we can easily interact with the webpage with methods like `click`, `type`, `focus_element` in correct spot. After the `crawl_page` method, the interactive elements will be labeled with numbers and stored in the `self.page_elements` property of the `WebBrowser` instance, then you can call the methods like `click`, `type`, `focus_element`.

The `crawlpage` method has three input args and four return values. You can choose whether to use the vision to add Set-Of-Mark to the webpage and whether to include meta_data field in the returned format text.
- Set-Of-Mark is a visual prompting method that partition an image into numbered regions, to improve the visual grounding ability of LLMs. Refer to the paper https://arxiv.org/abs/2310.11441 for detail. Checkout [our example](https://github.com/modelscope/agentscope/blob/main/examples/conversation_with_web_voyager_agent/README.md) for demostration.

`crawl_page` input args:
- vision(`bool`):
    Will add set-of-mark to webpage if vision is enabled and take screenshot. Here, instead of using segmentation model, we use the native JavaScript to bound the interactive elements in the webpage.
- with_meta(`bool`):
    Whether to include meta_data field in the returned format text.
- with_select (`bool`):
    Return only the selected interactive elements or all the numbered interactive elements.

`crawl_page` returns:
- elements:
    The handler from playwright of interactive elements. Will also be stored in the `self.page_elements` property of the `WebBrowser` instance.
- format_ele_text:
    A list of the formated elements' text descriptions, labeled with numbers star from zero.
- screenshot_bytes:
    The screenshot of webpage with Set-Of-Mark, in bytes. If you want to use vision-based MLLM, save the screenshot to a file using the `file_manager` module we provided and provide the image path using the format function.
- web_ele_infos:
    The info dict of interactive elements.

##### Perform Action
**Finally**, you can call methods like `click`, `type`, `focus_element` to interact with the webpage, with the labeled interactive elements, as well as other methods like `scroll`, `press_key`, `close`. You can refer to the api doc or even the [original code](https://github.com/modelscope/agentscope/blob/main/src/agentscope/browser/web_browser.py) for more details.

### Web Browsing Agent

The `WebVoyagerAgent` we implemented is a simple agent that can perform web browsing tasks. It is implemented in [web_voyager_agent.py](https://github.com/modelscope/agentscope/blob/main/src/agentscope/agents/web_voyager_agent.py).

The agent's reply function is implemented in the `reply` method of the `WebVoyagerAgent` class, and it follows the 1. visit web page -> 2. crawl the page -> 3. perform action -> 4. repeat iteration util achieve the goal.

You can try to interact with the agent in [our example](https://github.com/modelscope/agentscope/blob/main/examples/conversation_with_web_voyager_agent/). If you are capable, since the module is still in beta and the agent is far from perfect, you can try to improve it or even build an agent by yourself.

Enjoy exploring the web with our agent!



[[Back to the top]](#211-web-en)